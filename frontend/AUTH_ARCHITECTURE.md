# ğŸ” Authentication System Overview

## ğŸ¯ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Sign Up     â”‚  â”‚  Sign In     â”‚  â”‚   Header     â”‚          â”‚
â”‚  â”‚  Page        â”‚  â”‚  Page        â”‚  â”‚  Component   â”‚          â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚          â”‚
â”‚  â”‚ â€¢ Name       â”‚  â”‚ â€¢ Email      â”‚  â”‚ â€¢ User Info  â”‚          â”‚
â”‚  â”‚ â€¢ Email      â”‚  â”‚ â€¢ Password   â”‚  â”‚ â€¢ Logout     â”‚          â”‚
â”‚  â”‚ â€¢ Password   â”‚  â”‚ â€¢ GitHub     â”‚  â”‚ â€¢ Settings   â”‚          â”‚
â”‚  â”‚              â”‚  â”‚ â€¢ Google     â”‚  â”‚              â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      NEXTAUTH.JS LAYER                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           Authentication Providers                      â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ Credentials     â”‚  â”‚  GitHub     â”‚  â”‚  Google   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ Provider        â”‚  â”‚  OAuth      â”‚  â”‚  OAuth    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚             â”‚  â”‚           â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Email/Pass    â”‚  â”‚ â€¢ OAuth 2.0 â”‚  â”‚ â€¢ OAuth   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Bcrypt        â”‚  â”‚ â€¢ Profile   â”‚  â”‚ â€¢ Profile â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ JWT Token     â”‚  â”‚ â€¢ Token     â”‚  â”‚ â€¢ Token   â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Session Management                         â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  â€¢ JWT Tokens                                           â”‚    â”‚
â”‚  â”‚  â€¢ httpOnly Cookies                                     â”‚    â”‚
â”‚  â”‚  â€¢ CSRF Protection                                      â”‚    â”‚
â”‚  â”‚  â€¢ Session Callbacks                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE ACCESS LAYER                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         MongoDBAdapter (lib/mongodb-adapter.ts)        â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  âœ“ getUser(email)           â†’ Find user by email       â”‚    â”‚
â”‚  â”‚  âœ“ createUser(data)         â†’ Create new user          â”‚    â”‚
â”‚  â”‚  âœ“ updateUser(email, data)  â†’ Update user info         â”‚    â”‚
â”‚  â”‚  âœ“ updateApiKeys(email, keys) â†’ Store API keys         â”‚    â”‚
â”‚  â”‚  âœ“ getApiKeys(email)        â†’ Get user's API keys      â”‚    â”‚
â”‚  â”‚  âœ“ hashPassword(password)   â†’ Bcrypt hashing           â”‚    â”‚
â”‚  â”‚  âœ“ verifyPassword(plain, hash) â†’ Password check        â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       MONGODB DATABASE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚               Users Collection                          â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  {                                                       â”‚    â”‚
â”‚  â”‚    _id: ObjectId,                                       â”‚    â”‚
â”‚  â”‚    email: "user@example.com",                          â”‚    â”‚
â”‚  â”‚    password: "$2a$10$hashed...",  â† Bcrypt hash        â”‚    â”‚
â”‚  â”‚    name: "John Doe",                                    â”‚    â”‚
â”‚  â”‚    image: "https://avatar.url",                        â”‚    â”‚
â”‚  â”‚    apiKeys: {                                           â”‚    â”‚
â”‚  â”‚      togetherAI: "sk-...",      â† Encrypted            â”‚    â”‚
â”‚  â”‚      codeRabbit: "...",                                â”‚    â”‚
â”‚  â”‚      oumi: "...",                                      â”‚    â”‚
â”‚  â”‚      kestra: "..."                                     â”‚    â”‚
â”‚  â”‚    },                                                   â”‚    â”‚
â”‚  â”‚    createdAt: ISODate,                                 â”‚    â”‚
â”‚  â”‚    updatedAt: ISODate                                  â”‚    â”‚
â”‚  â”‚  }                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Authentication Flows

### 1. Email/Password Sign Up Flow

```
User                    Frontend               Backend                 Database
  â”‚                        â”‚                       â”‚                      â”‚
  â”‚   Fill Sign Up Form    â”‚                       â”‚                      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚                      â”‚
  â”‚                        â”‚                       â”‚                      â”‚
  â”‚   Submit               â”‚  POST /api/auth/signupâ”‚                      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
  â”‚                        â”‚                       â”‚                      â”‚
  â”‚                        â”‚                       â”‚  Check if email existsâ”‚
  â”‚                        â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                        â”‚                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                        â”‚                       â”‚  User not found      â”‚
  â”‚                        â”‚                       â”‚                      â”‚
  â”‚                        â”‚                       â”‚  Hash password       â”‚
  â”‚                        â”‚                       â”‚  (bcrypt, 10 rounds) â”‚
  â”‚                        â”‚                       â”‚                      â”‚
  â”‚                        â”‚                       â”‚  Create user         â”‚
  â”‚                        â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                        â”‚                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                        â”‚                       â”‚  User created âœ“      â”‚
  â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
  â”‚                        â”‚  201 Success          â”‚                      â”‚
  â”‚                        â”‚                       â”‚                      â”‚
  â”‚   Auto sign in         â”‚  signIn()             â”‚                      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
  â”‚                        â”‚                       â”‚  Create JWT session  â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
  â”‚   Redirect to home     â”‚  Session cookie âœ“     â”‚                      â”‚
  â”‚                        â”‚                       â”‚                      â”‚
```

### 2. Email/Password Sign In Flow

```
User                    Frontend               Backend                 Database
  â”‚                        â”‚                       â”‚                      â”‚
  â”‚   Fill Sign In Form    â”‚                       â”‚                      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚                      â”‚
  â”‚                        â”‚                       â”‚                      â”‚
  â”‚   Submit               â”‚  signIn('credentials')â”‚                      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
  â”‚                        â”‚                       â”‚                      â”‚
  â”‚                        â”‚                       â”‚  Find user by email  â”‚
  â”‚                        â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                        â”‚                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                        â”‚                       â”‚  User found âœ“        â”‚
  â”‚                        â”‚                       â”‚                      â”‚
  â”‚                        â”‚                       â”‚  Verify password     â”‚
  â”‚                        â”‚                       â”‚  (bcrypt compare)    â”‚
  â”‚                        â”‚                       â”‚  Password match âœ“    â”‚
  â”‚                        â”‚                       â”‚                      â”‚
  â”‚                        â”‚                       â”‚  Create JWT token    â”‚
  â”‚                        â”‚                       â”‚  Set httpOnly cookie â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
  â”‚   Redirect to home     â”‚  Session created âœ“    â”‚                      â”‚
  â”‚                        â”‚                       â”‚                      â”‚
```

### 3. OAuth Sign In Flow (GitHub/Google)

```
User              Frontend        NextAuth       OAuth Provider      Database
  â”‚                  â”‚               â”‚                  â”‚               â”‚
  â”‚  Click OAuth     â”‚               â”‚                  â”‚               â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚                  â”‚               â”‚
  â”‚                  â”‚  signIn('github')                â”‚               â”‚
  â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚               â”‚
  â”‚                  â”‚               â”‚  Redirect to     â”‚               â”‚
  â”‚                  â”‚               â”‚  OAuth provider  â”‚               â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
  â”‚                                                      â”‚               â”‚
  â”‚  Authorize App (GitHub/Google page)                 â”‚               â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
  â”‚                                                      â”‚               â”‚
  â”‚  Redirect back with token                           â”‚               â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
  â”‚                  â”‚               â”‚                  â”‚               â”‚
  â”‚                  â”‚               â”‚  Verify token    â”‚               â”‚
  â”‚                  â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
  â”‚                  â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
  â”‚                  â”‚               â”‚  Token valid âœ“   â”‚               â”‚
  â”‚                  â”‚               â”‚                  â”‚               â”‚
  â”‚                  â”‚               â”‚  Get user profileâ”‚               â”‚
  â”‚                  â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
  â”‚                  â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
  â”‚                  â”‚               â”‚  Profile data    â”‚               â”‚
  â”‚                  â”‚               â”‚                  â”‚               â”‚
  â”‚                  â”‚               â”‚  Check if user exists            â”‚
  â”‚                  â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                  â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                  â”‚               â”‚  User exists / Create new        â”‚
  â”‚                  â”‚               â”‚                                  â”‚
  â”‚                  â”‚               â”‚  Create JWT session              â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                  â”‚
  â”‚  Redirect to home with session   â”‚                                  â”‚
  â”‚                  â”‚               â”‚                                  â”‚
```

### 4. Code Generation with User API Keys

```
User              Frontend         Generate API      User API        Database
  â”‚                  â”‚                  â”‚               â”‚               â”‚
  â”‚  Enter prompt    â”‚                  â”‚               â”‚               â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚               â”‚               â”‚
  â”‚                  â”‚  Check auth      â”‚               â”‚               â”‚
  â”‚                  â”‚  (useSession)    â”‚               â”‚               â”‚
  â”‚                  â”‚  âœ“ Authenticated â”‚               â”‚               â”‚
  â”‚                  â”‚                  â”‚               â”‚               â”‚
  â”‚  Submit          â”‚  POST /api/generate              â”‚               â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚               â”‚
  â”‚                  â”‚                  â”‚               â”‚               â”‚
  â”‚                  â”‚                  â”‚  Check sessionâ”‚               â”‚
  â”‚                  â”‚                  â”‚  (getServerSession)           â”‚
  â”‚                  â”‚                  â”‚  âœ“ Valid      â”‚               â”‚
  â”‚                  â”‚                  â”‚               â”‚               â”‚
  â”‚                  â”‚                  â”‚  GET /api/user/api-keys       â”‚
  â”‚                  â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
  â”‚                  â”‚                  â”‚               â”‚               â”‚
  â”‚                  â”‚                  â”‚               â”‚  Get user     â”‚
  â”‚                  â”‚                  â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                  â”‚                  â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                  â”‚                  â”‚               â”‚  User + keys  â”‚
  â”‚                  â”‚                  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
  â”‚                  â”‚                  â”‚  API keys âœ“   â”‚               â”‚
  â”‚                  â”‚                  â”‚               â”‚               â”‚
  â”‚                  â”‚                  â”‚  Use user's Together AI key   â”‚
  â”‚                  â”‚                  â”‚  to generate code             â”‚
  â”‚                  â”‚                  â”‚               â”‚               â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚               â”‚
  â”‚  Generated code  â”‚  200 Success     â”‚               â”‚               â”‚
  â”‚                  â”‚                  â”‚               â”‚               â”‚
```

### 5. API Key Management Flow

```
User              Settings Page    API Keys API         Database
  â”‚                  â”‚                  â”‚                   â”‚
  â”‚  Go to Settings  â”‚                  â”‚                   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚                   â”‚
  â”‚                  â”‚  Check auth      â”‚                   â”‚
  â”‚                  â”‚  (useSession)    â”‚                   â”‚
  â”‚                  â”‚  âœ“ Authenticated â”‚                   â”‚
  â”‚                  â”‚                  â”‚                   â”‚
  â”‚  Page loads      â”‚  GET /api/user/api-keys             â”‚
  â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
  â”‚                  â”‚                  â”‚                   â”‚
  â”‚                  â”‚                  â”‚  Get user's keys  â”‚
  â”‚                  â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                  â”‚                  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                  â”‚                  â”‚  Keys found       â”‚
  â”‚                  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
  â”‚                  â”‚  Masked keys     â”‚                   â”‚
  â”‚                  â”‚  (show first 8   â”‚                   â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   + last 4 chars)â”‚                   â”‚
  â”‚  Display keys    â”‚                  â”‚                   â”‚
  â”‚  sk-abc123...xyz â”‚                  â”‚                   â”‚
  â”‚                  â”‚                  â”‚                   â”‚
  â”‚  Update keys     â”‚                  â”‚                   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚                   â”‚
  â”‚                  â”‚  POST /api/user/api-keys            â”‚
  â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
  â”‚                  â”‚  { togetherAI: "sk-new-key" }       â”‚
  â”‚                  â”‚                  â”‚                   â”‚
  â”‚                  â”‚                  â”‚  Update user doc  â”‚
  â”‚                  â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                  â”‚                  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                  â”‚                  â”‚  Updated âœ“        â”‚
  â”‚                  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  200 Success     â”‚                   â”‚
  â”‚  Success message â”‚                  â”‚                   â”‚
  â”‚                  â”‚                  â”‚                   â”‚
```

## ğŸ”’ Security Features

### Password Security
```
Plain Password          Bcrypt Processing           Stored Hash
     â”‚                        â”‚                         â”‚
  "myPass123"                 â”‚                         â”‚
     â”‚                        â”‚                         â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚
     â”‚   bcrypt.hash()        â”‚                         â”‚
     â”‚   Salt rounds: 10      â”‚                         â”‚
     â”‚                        â”‚                         â”‚
     â”‚                   Generate salt                  â”‚
     â”‚                   (random 22 chars)              â”‚
     â”‚                        â”‚                         â”‚
     â”‚                   Hash with salt                 â”‚
     â”‚                   (60 iterations)                â”‚
     â”‚                        â”‚                         â”‚
     â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                        â”‚  "$2a$10$N9qo8uLO..."  â”‚
     â”‚                        â”‚   ^   ^  ^              â”‚
     â”‚                        â”‚   â”‚   â”‚  â””â”€ Salt        â”‚
     â”‚                        â”‚   â”‚   â””â”€ Cost factor    â”‚
     â”‚                        â”‚   â””â”€ Algorithm version  â”‚
     â”‚                        â”‚                         â”‚
```

### Session Security
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              JWT Token Structure                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  Header                                             â”‚
â”‚  {                                                  â”‚
â”‚    "alg": "HS256",                                 â”‚
â”‚    "typ": "JWT"                                    â”‚
â”‚  }                                                  â”‚
â”‚                                                      â”‚
â”‚  Payload                                            â”‚
â”‚  {                                                  â”‚
â”‚    "email": "user@example.com",                    â”‚
â”‚    "name": "John Doe",                             â”‚
â”‚    "iat": 1234567890,        â† Issued at           â”‚
â”‚    "exp": 1234571490         â† Expires (1 hour)    â”‚
â”‚  }                                                  â”‚
â”‚                                                      â”‚
â”‚  Signature (HMAC SHA256)                           â”‚
â”‚  HMACSHA256(                                        â”‚
â”‚    base64UrlEncode(header) + "." +                 â”‚
â”‚    base64UrlEncode(payload),                       â”‚
â”‚    NEXTAUTH_SECRET                                  â”‚
â”‚  )                                                  â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Cookie Configuration                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ“ httpOnly: true     â† Not accessible via JS     â”‚
â”‚  âœ“ secure: true       â† HTTPS only (production)   â”‚
â”‚  âœ“ sameSite: 'lax'    â† CSRF protection           â”‚
â”‚  âœ“ path: '/'          â† Available site-wide       â”‚
â”‚  âœ“ maxAge: 3600       â† 1 hour expiration         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Database Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Users Collection                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Field         Type        Description          Indexed      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  _id           ObjectId    Unique identifier    âœ“ Primary   â”‚
â”‚  email         String      User email           âœ“ Unique    â”‚
â”‚  password      String      Bcrypt hash          -           â”‚
â”‚  name          String      User name            -           â”‚
â”‚  image         String      Profile image URL    -           â”‚
â”‚  apiKeys       Object      API keys object      -           â”‚
â”‚    â”œâ”€ togetherAI  String  Together AI key      -           â”‚
â”‚    â”œâ”€ codeRabbit  String  CodeRabbit key       -           â”‚
â”‚    â”œâ”€ oumi        String  Oumi key             -           â”‚
â”‚    â””â”€ kestra      String  Kestra key           -           â”‚
â”‚  createdAt     Date        Creation timestamp   âœ“ Index     â”‚
â”‚  updatedAt     Date        Update timestamp     -           â”‚
â”‚                                                               â”‚
â”‚  Indexes:                                                    â”‚
â”‚  âœ“ { email: 1 } - Unique index for fast lookups            â”‚
â”‚  âœ“ { createdAt: -1 } - Sort by creation date               â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Protected Routes

```
Route                    Auth Required    Behavior if Not Authenticated
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/                        âŒ No            Public access
/auth/signin            âŒ No            Public signin page
/auth/signup            âŒ No            Public signup page
/settings               âœ… Yes           Redirect to /auth/signin
/api/generate           âœ… Yes           Return 401 Unauthorized
/api/user/api-keys      âœ… Yes           Return 401 Unauthorized
/api/auth/[...nextauth] âŒ No            NextAuth endpoints
```

## ğŸ“ˆ User Journey

```
New User Journey:
1. Visit homepage
2. Click "Sign Up"
3. Fill registration form
4. Submit â†’ Account created
5. Auto-signed in
6. Redirected to home
7. Go to Settings
8. Add API keys
9. Generate code âœ“

Returning User Journey:
1. Visit homepage
2. Click "Sign In"
3. Enter credentials OR use OAuth
4. Signed in
5. Generate code (uses saved API keys) âœ“

OAuth User Journey:
1. Visit homepage
2. Click "Sign In"
3. Click "Continue with GitHub/Google"
4. Authorize app
5. Redirected back
6. Account created/signed in
7. Generate code âœ“
```

---

**This comprehensive authentication system provides enterprise-grade security while maintaining excellent user experience!** ğŸ”’âœ¨
